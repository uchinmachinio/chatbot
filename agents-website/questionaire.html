<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="dark" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://studio.d-id.com/favicon/favicon-192x192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- Shoelace dark theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
  <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
  <title>CRED Fitness</title>
  <style>
    .video-stack {
      position: relative
    }

    .video-stack video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 250ms ease
    }
  </style>
</head>

<body class="bg-neutral-950 text-neutral-100 font-[Manrope] min-h-screen">
  <!-- Fullscreen Grid -->
  <div class="h-screen grid grid-cols-12 gap-6 p-6">

    <!-- Avatar Section (Left) -->
    <div class="rounded-lg col-span-4 border border-white/10 bg-neutral-900/60 shadow-lg backdrop-blur-sm flex h-full">
      <div class="flex-1 flex flex-col p-6 pt-20">
        <!-- Header -->
        <h2 class="text-xl font-semibold text-center mb-4 text-neutral-100">Your Fitness Coach</h2>

        <!-- Avatar Placeholder (full height) -->
        <div class="w-full h-full rounded-xl ring-1 ring-white/10 bg-neutral-800/50 overflow-hidden p-3">
          <div id="video-wrapper" class="relative w-full h-full rounded-lg overflow-hidden">
            <!-- Full-height, centered, allowed to crop left/right -->
            <video id="streamVideoElement" class="absolute inset-0 w-full h-full object-cover object-center" autoplay
              loop style="opacity:1;"></video>
            <video id="idleVideoElement" class="absolute inset-0 w-full h-full object-cover object-center" autoplay loop
              style="opacity:0;"></video>
          </div>
        </div>
      </div>
    </div>

    <!-- Chatbox Section (Middle) -->
    <div
      class="flex flex-col gap-3 col-span-5 rounded-lg border border-white/10 bg-neutral-900/60 shadow-lg p-4 backdrop-blur-sm min-h-0 h-full">

      <!-- Chat Messages -->
      <div class="rounded-xl p-4 bg-neutral-900 ring-1 ring-white/10 flex flex-col flex-1 min-h-0">
        <div id="answersList" class="flex-1 overflow-y-auto p-3 space-y-2">
          <!-- Chat messages will be appended here -->
        </div>
      </div>

      <!-- Input Row -->
      <div class="flex gap-2">
        <textarea id="textArea" placeholder="Type your answer..." autofocus
          class="flex-1 rounded-lg bg-neutral-800 text-neutral-100 placeholder:text-neutral-500 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500/40 focus:border-blue-400/40"></textarea>

        <button id="speechButton"
          class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
          title="Speech to Text">
          <span class="material-symbols-outlined text-base">mic</span>
        </button>
        <button id="actionButton"
          class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
          title="Send Message">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 26 27" fill="currentColor"
            aria-hidden="true">
            <path
              d="M10.8753 20.9288L15.8809 18.3172C20.2537 16.0357 22.4402 14.895 22.4402 13.0885C22.4402 11.2821 20.2537 10.1413 15.8809 7.85984L10.8753 5.24821C7.34598 3.40683 5.58133 2.48614 4.5583 2.76876C3.58508 3.03761 2.82497 3.83076 2.56732 4.84629C2.29649 5.91381 3.17881 7.75518 4.94346 11.4379C5.16215 11.8943 5.60928 12.198 6.09829 12.2003L14.0891 12.2391C14.5386 12.2413 14.9014 12.6234 14.8993 13.0925C14.8972 13.5616 14.531 13.9401 14.0815 13.9379L6.21975 13.8997C5.68076 13.8971 5.1845 14.2361 4.94346 14.7391C3.17882 18.4218 2.29648 20.2632 2.56732 21.3307C2.82497 22.3463 3.58507 23.1394 4.5583 23.4083C5.58133 23.6909 7.34599 22.7702 10.8753 20.9288Z" />
          </svg>
        </button>
        <button id="interruptButton"
          class="grid size-12 place-items-center rounded-full border border-neutral-800 bg-black" title="Interrupt"
          hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path
              d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12Z"
              stroke="currentcolor" stroke-width="1.5" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Step Progress Bar (Right) -->
    <div
      class="col-span-3 rounded-lg border border-white/10 bg-neutral-900/60 shadow-lg flex items-center justify-center backdrop-blur-sm">
      <div class="flex flex-col items-start justify-start space-y-25 h-full pt-8">

        <!-- Step 1 (active) -->
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-bold">
            1</div>
          <span class="text-neutral-100 font-medium">Basics</span>
        </div>

        <!-- Step 2 -->
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-300 text-sm font-bold">
            2</div>
          <span class="text-neutral-300">Health & Lifestyle</span>
        </div>

        <!-- Step 3 -->
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-300 text-sm font-bold">
            3</div>
          <span class="text-neutral-300">Goals & Preferences</span>
        </div>

        <!-- Step 4 -->
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-300 text-sm font-bold">
            4</div>
          <span class="text-neutral-300">Schedule</span>
        </div>

        <!-- Step 5 -->
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-300 text-sm font-bold">
            5</div>
          <span class="text-neutral-300">Nutrition & Wellness</span>
        </div>
      </div>
    </div>

  </div>
  <div id="hidden" style="display:none;">
    <h2 id="hidden_h2"></h2>
    <br />
    <h3>Want to continue where we left off?</h3>
    <br /><button id="reconnectButton" class="rounded-full bg-neutral-800 px-4 py-2 text-sm"
      title="Reconnects the previous WebRTC session">Let's
      continue</button>
  </div>
  <!-- Questionnaire Scripts here-->
  <script type="module" src="./questionnaire_video.js" defer></script>
  <script src="/questionnaire.js"></script>
  <script src="/webSpeechAPI.js"></script>
</body>

</html>