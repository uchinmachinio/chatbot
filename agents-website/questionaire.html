<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="dark" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://studio.d-id.com/favicon/favicon-192x192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- Shoelace dark theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
  <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
  <title>CRED Fitness</title>
  <style>
    .video-stack {
      position: relative
    }

    .video-stack video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 250ms ease
    }
  </style>
</head>

<body class="bg-neutral-950 text-neutral-100 font-[Manrope] min-h-screen">
  <!-- Fullscreen Grid -->
  <div class="h-screen grid grid-cols-12 gap-6 p-6">

    <!-- Avatar Section (Left) -->
    <div class="rounded-lg col-span-4 border border-white/10 bg-neutral-900/60 shadow-lg backdrop-blur-sm flex h-full">
      <div class="flex-1 flex flex-col p-6 pt-20">
        <!-- Header -->
        <h2 class="text-xl font-semibold text-center mb-4 text-neutral-100">Your Fitness Coach</h2>

        <!-- Avatar Placeholder (full height) -->
        <div class="w-full h-full rounded-xl ring-1 ring-white/10 bg-neutral-800/50 overflow-hidden p-3">
          <div id="video-wrapper" class="relative w-full h-full rounded-lg overflow-hidden">
            <!-- Full-height, centered, allowed to crop left/right -->
            <video id="streamVideoElement" class="absolute inset-0 w-full h-full object-cover object-center" autoplay
              loop style="opacity:1;"></video>
            <video id="idleVideoElement" class="absolute inset-0 w-full h-full object-cover object-center" autoplay loop
              style="opacity:0;"></video>
          </div>
        </div>
      </div>
    </div>

    <!-- Chatbox Section (Middle) -->
    <div
      class="flex flex-col gap-3 col-span-5 rounded-lg border border-white/10 bg-neutral-900/60 shadow-lg p-4 backdrop-blur-sm min-h-0 h-full">

      <!-- Chat Messages -->
      <div class="rounded-xl p-4 bg-neutral-900 ring-1 ring-white/10 flex flex-col flex-1 min-h-0">
        <div id="answersList" class="flex-1 overflow-y-auto p-3 space-y-2">
          <!-- Chat messages will be appended here -->
        </div>
      </div>

      <!-- Input Row -->
      <div class="flex gap-2">
        <textarea id="textArea" placeholder="Type your answer..." autofocus
          class="flex-1 rounded-lg bg-neutral-800 text-neutral-100 placeholder:text-neutral-500 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500/40 focus:border-blue-400/40"></textarea>

        <button id="speechButton"
          class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
          title="Speech to Text">
          <span class="material-symbols-outlined text-base">mic</span>
        </button>
        <button id="actionButton"
          class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
          title="Send Message">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 26 27" fill="currentColor"
            aria-hidden="true">
            <path
              d="M10.8753 20.9288L15.8809 18.3172C20.2537 16.0357 22.4402 14.895 22.4402 13.0885C22.4402 11.2821 20.2537 10.1413 15.8809 7.85984L10.8753 5.24821C7.34598 3.40683 5.58133 2.48614 4.5583 2.76876C3.58508 3.03761 2.82497 3.83076 2.56732 4.84629C2.29649 5.91381 3.17881 7.75518 4.94346 11.4379C5.16215 11.8943 5.60928 12.198 6.09829 12.2003L14.0891 12.2391C14.5386 12.2413 14.9014 12.6234 14.8993 13.0925C14.8972 13.5616 14.531 13.9401 14.0815 13.9379L6.21975 13.8997C5.68076 13.8971 5.1845 14.2361 4.94346 14.7391C3.17882 18.4218 2.29648 20.2632 2.56732 21.3307C2.82497 22.3463 3.58507 23.1394 4.5583 23.4083C5.58133 23.6909 7.34599 22.7702 10.8753 20.9288Z" />
          </svg>
        </button>
        <button id="interruptButton"
          class="grid size-12 place-items-center rounded-full border border-neutral-800 bg-black" title="Interrupt"
          hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path
              d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12Z"
              stroke="currentcolor" stroke-width="1.5" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Profile Status (Right) -->
    <div class="col-span-3 rounded-lg border border-white/10 bg-neutral-900/60 shadow-lg backdrop-blur-sm">
      <!-- Tiny CSS for micro-animations + dashed "missing" pills -->
      <style>
        @keyframes pop-in {
          0% {
            transform: scale(.95);
            opacity: 0
          }

          100% {
            transform: scale(1);
            opacity: 1
          }
        }

        @keyframes shimmer {
          0% {
            background-position: -200% 0
          }

          100% {
            background-position: 200% 0
          }
        }

        .pop-in {
          animation: pop-in 220ms cubic-bezier(.2, .8, .2, 1);
        }

        .tag-missing {
          border: 1px dashed rgba(255, 255, 255, .25);
          background: linear-gradient(90deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.06));
          background-size: 200% 100%;
          animation: shimmer 1.6s linear infinite;
        }

        .tagged {
          border: 2px dashed rgba(0, 162, 255, .52);
          background: linear-gradient(90deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.06));
          background-size: 200% 100%;
          animation: shimmer 1.6s linear infinite;
        }

        /* === CTA styles === */
        @keyframes fade-in-up {
          from {
            opacity: 0;
            transform: translateY(6px);
          }

          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        /* Style Shoelace button via parts */
        #workoutReady::part(base) {
          --sl-input-border-width: 0;
          background: linear-gradient(135deg, #22d3ee 0%, #3b82f6 50%, #a855f7 100%);
          color: white;
          font-weight: 800;
          letter-spacing: .04em;
          text-transform: uppercase;
          padding-inline: 1.25rem;
          padding-block: .9rem;
          border-radius: 9999px;
          box-shadow:
            0 10px 25px rgba(59, 130, 246, .25),
            0 2px 6px rgba(0, 0, 0, .35),
            inset 0 0 0 1px rgba(255, 255, 255, .12);
          transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
          backdrop-filter: blur(2px);
        }

        #workoutReady::part(base):hover {
          transform: translateY(-1px);
          box-shadow:
            0 14px 32px rgba(59, 130, 246, .32),
            0 3px 8px rgba(0, 0, 0, .4),
            inset 0 0 0 1px rgba(255, 255, 255, .18);
          filter: brightness(1.03);
        }

        #workoutReady::part(base):active {
          transform: translateY(0);
          filter: brightness(.98);
        }

        /* Subtle glow aura behind the button */
        .cta-glow {
          position: relative;
          display: grid;
          place-items: center;
        }

        .cta-glow::before {
          content: "";
          position: absolute;
          inset: -10px;
          border-radius: 9999px;
          background: radial-gradient(60% 60% at 50% 50%, rgba(59, 130, 246, .35), rgba(168, 85, 247, .18) 45%, transparent 70%);
          filter: blur(12px);
          z-index: 0;
          pointer-events: none;
          opacity: .8;
        }

        /* Fade-in utility (apply when un-hiding) */
        .fade-in-up {
          animation: fade-in-up .45s cubic-bezier(.22, .8, .2, 1) both;
        }
      </style>

      <!-- Header -->
      <div class="px-4 pt-4 pb-3 border-b border-white/10 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <sl-icon name="person" class="text-neutral-300"></sl-icon>
          <h3 class="text-neutral-100 font-semibold tracking-tight">User Workout Profile</h3>
        </div>
      </div>

      <!-- Steps + content -->
      <div class="p-4 space-y-6">
        <!-- Fields (Schema: complete coverage) -->
        <div class="space-y-5">
          <!-- 0. Name -->
          <section class="space-y-2">
            <div id="basics" class="flex items-center gap-2 text-lg uppercase tracking-wider text-neutral-400">
              <sl-icon name="person-circle" class="opacity-70"></sl-icon> Basics
            </div>
            <div class="flex flex-wrap gap-2">
              <sl-badge pill variant="primary" class="pop-in" data-field="name">Name: Luka</sl-badge>
              <sl-badge pill variant="primary" class="pop-in" data-field="age">Age: 29</sl-badge>
              <sl-badge pill variant="primary" class="pop-in" data-field="heightCm">Height: 183 cm</sl-badge>
              <sl-badge pill variant="primary" class="pop-in" data-field="weightKg">Weight: 82 kg</sl-badge>
            </div>
          </section>

          <!-- 2. Current fitness level -->
          <section class="space-y-2">
            <div id="fitness" class="flex items-center gap-2 text-lg uppercase tracking-wider text-neutral-400">
              <sl-icon name="activity" class="opacity-70"></sl-icon> Fitness Level
            </div>
            <div class="flex flex-wrap gap-2">
              <sl-badge pill variant="primary" class="pop-in" data-field="fitnessLevel">intermediate</sl-badge>
            </div>
          </section>

          <!-- 3. Lifestyle -->
          <section class="space-y-2">
            <div id="lifestyle" class="flex items-center gap-2 text-lg uppercase tracking-wider text-neutral-400">
              <sl-icon name="briefcase" class="opacity-70"></sl-icon> Lifestyle
            </div>
            <div class="flex flex-wrap gap-2" data-field="lifestyle">
              <sl-badge pill variant="primary" class="pop-in">mixed</sl-badge>
              <sl-badge pill variant="primary" class="pop-in">office_work</sl-badge>
            </div>
          </section>

          <!-- 4. Fitness goals + timeline -->
          <section class="space-y-2">
            <div id="goals" class="flex items-center gap-2 text-lg uppercase tracking-wider text-neutral-400">
              <sl-icon name="trophy" class="opacity-70"></sl-icon> Goals & Timeline
            </div>
            <div class="flex flex-wrap gap-2" data-field="goals">
              <sl-badge pill variant="primary" class="pop-in">muscle_gain</sl-badge>
              <sl-badge pill variant="primary" class="pop-in">mobility_flexibility</sl-badge>
            </div>
            <div class="flex flex-wrap gap-2" data-field="targetTimelineWeeks">
              <sl-badge pill variant="primary" class="pop-in">
                <sl-icon name="hourglass-split" class="mr-1"></sl-icon>
                Target: 16 weeks
              </sl-badge>
            </div>
          </section>

          <!-- 5. Preferred workout style + equipment -->
          <section class="space-y-2">
            <div id="preferences" class="flex items-center gap-2 text-lg uppercase tracking-wider text-neutral-400">
              <sl-icon name="sliders" class="opacity-70"></sl-icon> Preferences
            </div>
            <div class="flex flex-col gap-2">
              <div class="flex flex-wrap gap-2" data-field="preferredStyles">
                <sl-badge pill variant="primary" class="pop-in">strength_training</sl-badge>
                <sl-badge pill variant="primary" class="pop-in">hiit</sl-badge>
              </div>
              <div class="flex flex-wrap gap-2" data-field="equipmentAvailable">
                <sl-badge pill variant="primary" class="pop-in">adjustable dumbbells</sl-badge>
                <sl-badge pill variant="primary" class="pop-in">pull-up bar</sl-badge>
                <sl-badge pill variant="primary" class="pop-in">resistance bands</sl-badge>
              </div>
            </div>
          </section>
        </div>

        <!-- CTA footer -->
        <div class="pt-4 mt-2 border-t border-white/10">
          <div class="cta-glow flex justify-center">
            <!-- Initially hidden; remove `hidden` to reveal. Add `fade-in-up` to animate in. -->
            <sl-button id="workoutReady" size="large" pill class="fade-in-up" hidden>
              Workout Ready
            </sl-button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>
  <div id="hidden" style="display:none;">
    <h2 id="hidden_h2"></h2>
    <br />
    <h3>Want to continue where we left off?</h3>
    <br /><button id="reconnectButton" class="rounded-full bg-neutral-800 px-4 py-2 text-sm"
      title="Reconnects the previous WebRTC session">Let's
      continue</button>
  </div>
  <!-- Questionnaire Scripts here-->
  <script type="module" src="./questionnaire_video.js" defer></script>
  <script type="module" src="/questionnaire.js"></script>
  <script src="/webSpeechAPI.js"></script>
  <script type="module">
    import { renderUserWorkoutProfile, exampleFilledProfile, demo } from "./renderProfile.js";

    // Render something right away:
    // renderUserWorkoutProfile(exampleFilledProfile);

    // Or run demo to test
    demo();
  </script>
</body>

</html>