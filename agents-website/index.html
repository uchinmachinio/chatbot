<html lang="en" class="sl-theme-dark h-full">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://studio.d-id.com/favicon/favicon-192x192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
  <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
  <title>CRED Fitness</title>
  <style>
    .video-stack {
      position: relative
    }

    .video-stack video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 250ms ease
    }
  </style>
</head>

<body class="bg-neutral-950 text-neutral-100 font-[Manrope] h-full">
  <div class="grid h-svh grid-cols-3 grid-rows-6 gap-4 p-4">
    <main class="col-span-2 row-span-6 grid grid-cols-2 grid-rows-6 gap-4 min-h-0">
      <section
        class="col-span-2 row-start-1 row-span-3 rounded-2xl border border-neutral-800 bg-neutral-900/60 p-3 grid grid-cols-3 gap-3 min-h-48 h-full">
        <div class="col-span-2 flex flex-col min-h-0">
          <div class="px-2 pt-1 text-sm font-semibold">Your AI Coach</div>
          <div id="video-wrapper" class="relative flex-1 video-stack rounded-xl overflow-hidden">
            <video id="streamVideoElement" autoplay loop style="opacity:1;"></video>
            <video id="idleVideoElement" autoplay loop style="opacity:0;"></video>
          </div>
        </div>
        <div
          class="col-span-1 rounded-2xl border border-sky-700/40 bg-gradient-to-t from-gray-400 to-red-200 p-3 text-xs">
          <div class="relative w-full h-full overflow-hidden bg-transparent">
            <!-- Animation will be rendered here -->
            <img id="keyframeImg" class="w-full h-full object-cover brightness-0">
          </div>
        </div>
      </section>
      <section
        class=" col-start-1 row-start-4 row-span-1 rounded-2xl border border-violet-700/40 bg-gradient-to-t from-violet-900/40 to-fuchsia-900/40 p-2">
        <div id="trainingChart" class="w-full h-full">
          <!-- Training progress chart will be rendered here -->
        </div>
      </section>
      <section
        class="col-start-2 row-start-4 row-span-2 rounded-2xl border border-sky-700/40 bg-gradient-to-br from-sky-700/30 to-cyan-600/30 p-4">
        <div class="w-full h-2/3 rounded-xl overflow-hidden">
          <div id="hrChart"></div>
          <!-- Heart rate chart will be rendered here -->
        </div>
        <div>
          <!-- Target HR bar -->
          <div class="flex flex-col justify-center">
            <div class="flex items-end justify-between mb-1">
              <div class="text-slate-300 items-center">
                <span class="text-xs uppercase tracking-wider">HEART RATE</span>
                <span id="heartIcon" class="inline-block text-red-500" style="font-size: 1rem;">‚ù§Ô∏è</span>
                <span id="hrNow"></span> bpm
              </div>
              <div class="text-sm font-semibold">
                <div class="flex items-center gap-1">
                  <span class="text-[13px] font-normal text-slate-400"> (Target 70‚Äì85% MHR)</span>
                </div>
              </div>
            </div>

            <!-- HR zones bar with current marker -->
            <!-- Set these inline (example): data-mhr="190" data-hr="148" -->
            <div id="hrBar" class="relative h-3 rounded-full overflow-hidden" data-mhr="190" data-hr="130" style="
             /* Multi-zone background from 0%‚Üí100% of MHR */
             background:
               linear-gradient(to right,
                 #60a5fa 0% 60%,      /* Warm-up  <60% */
                 #22c55e 60% 70%,     /* Fat burn 60‚Äì70% */
                 #f59e0b 70% 85%,     /* Cardio   70‚Äì85% */
                 #ef4444 85% 100%     /* Peak     >85% */
               );
           ">
              <!-- Target zone overlay (70‚Äì85% MHR) -->
              <div class="absolute inset-y-0"
                style="left: 70%; width: 15%; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.5), rgba(255,255,255,0.5) 6px, rgba(255,255,255,0.05) 6px, rgba(255,255,255,0.05) 12px);">
              </div>

              <!-- Current HR marker; position set via JS below -->
              <div id="hrMarker" class="absolute top-1/2 -translate-y-1/2" style="left: 0%;">
                <div class="w-2 h-2 rounded-full bg-white ring-2 ring-black/40 shadow"></div>
              </div>
            </div>

            <!-- Scale labels -->
            <div class="mt-1 flex justify-between text-[11px] text-slate-400">
              <span class="ml-auto text-red-300">MHR</span>
            </div>
          </div>
        </div>
      </section>
      <section>
        <div class="w-full h-full">
          <!-- NOW PLAYING CARD -->
          <sl-card class="block border border-white/30 rounded-2xl overflow-hidden shadow-lg">
            <div>
              <!-- Header: title + meta -->
              <div class="flex items-start justify-between gap-1">
                <div>
                  <h2 id="title" class="text-lg sm:text-xl font-semibold tracking-tight">High Intensity Interval
                    Training</h2>
                  <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-slate-400">
                    <span class="chip bg-white/5">‚è±Ô∏è <span id="duration" class="tabular-nums">20</span></span>
                    <span class="chip bg-white/5">üîÅ <span id="rounds" class="tabular-nums">4</span></span>
                    <span class="chip bg-white/5">üè∑Ô∏è <span id="type">HIIT</span></span>
                  </div>
                </div>
                <!-- Round progress compact -->
                <div class="text-right">
                  <div class="text-[10px] uppercase tracking-wider text-slate-400">Round</div>
                  <div id="roundProgress" class="text-sm font-semibold">1 / 4</div>
                </div>
              </div>

              <!-- Main row: details -->
              <div class="mt-5 grid grid-cols-[auto,1fr] gap-4 items-center">
                <!-- Current exercise & intensity -->
                <div class="mt-2">
                  <div class="text-[11px] uppercase tracking-wider text-slate-400">Now</div>
                  <div class="text-xl sm:text-2xl font-bold leading-tight">
                    <span id="exercise">Burpees</span>
                    <sl-progress-ring id="timeLeftProgress" value="100" class="inline-block align-middle"
                      style="--size: 30px; --track-width: 12px; --indicator-width: 6px;">
                    </sl-progress-ring>
                  </div>

                  <div class="mt-2 flex items-center gap-2">
                    <span id="intensityBadge" class="chip">Intensity: LOW</span>
                    <span class="text-xs text-slate-400">Remaining:</span>
                    <span id="timeLeft" class="text-lg font-semibold tabular-nums">00:40</span>
                  </div>

                  <!-- Mini metadata row -->
                  <div class="mt-3 flex flex-wrap gap-2 text-xs">
                    <span class="chip bg-white/5">üèãÔ∏è‚Äç‚ôÇÔ∏è <span id="equip">bodyweight</span></span>
                    <span class="chip bg-white/5">üí™ <span id="zones">cardio ‚Ä¢ legs ‚Ä¢ core</span></span>
                    <span class="chip bg-white/5">üéØ <span id="goal">goal: fat_burn</span></span>
                  </div>
                </div>
              </div>
            </div>
          </sl-card>
        </div>
      </section>
      <section
        class="col-start-2 row-start-6 row-span-3 rounded-2xl border border-rose-700/40 bg-gradient-to-br from-rose-700/30 to-pink-600/30 p-4">
        <!-- Metrics: 2 rings + HR bar -->
        <div class="mt-4 grid gap-6 md:grid-cols-3">
          <!-- Calories burned (ring) -->
          <div class="flex items-center gap-4">
            <!-- Calories burned (ring with image inside) -->
            <div class="relative inline-block">
              <sl-progress-ring value="0" id="caloriesProgress"
                style="--size: 72px; --track-color: rgba(255,255,255,0.15); --indicator-color: #ef4444; --indicator-width: 7px;">
              </sl-progress-ring>
              <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <img src="/calories.png" alt="Calories" class="w-12 h-12">
              </div>
            </div>
            <div>
              <div class="text-xs uppercase tracking-wider text-slate-300">Calories</div>
              <div class="text-lg font-semibold"><span id="caloriesBurned">310</span> kcal</div>
              <div class="text-[11px] text-slate-400">Goal: <span id="caloriesGoal">500</span></div>
            </div>
          </div>

          <!-- Steps (ring) -->
          <div class="flex items-center gap-4">
            <div class="relative inline-block">
              <sl-progress-ring value="45" class="shrink-0"
                style="--size: 72px; --track-color: rgba(255,255,255,0.15); --indicator-color: #22c55e; --indicator-width: 7px;">
              </sl-progress-ring>
              <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <img src="/steps.png" alt="Calories" class="w-12 h-12">
              </div>
            </div>
            <div>
              <div class="text-xs uppercase tracking-wider text-slate-300">Steps</div>
              <div class="text-lg font-semibold"><span id="stepsSoFar">4,500</span></div>
              <div class="text-[11px] text-slate-400">Goal: <span id="stepsGoal">10,000</span></div>
            </div>
          </div>

          <!-- Simple circular Start button -->
          <button id="startButton" type="button" aria-label="Start" class="grid place-items-center rounded-full size-20 bg-emerald-600 text-white 
         shadow-lg ring-1 ring-white/10 hover:bg-emerald-500 
         active:scale-[0.98] transition disabled:opacity-40 
         disabled:cursor-not-allowed">
            <!-- Use Shoelace icon if available; fallback text keeps it simple -->
            <sl-icon name="play-fill" class="text-white text-lg size-10"></sl-icon>
          </button>
        </div>
      </section>
    </main>
    <aside class="flex col-start-3 row-span-6 min-h-0 rounded-2xl border border-neutral-800 bg-neutral-900/60">
      <div class="flex w-full min-h-0 flex-col">
        <div class="flex items-center justify-between border-b border-neutral-800 px-4 py-3">
          <h2 class="text-sm font-semibold">Chat History</h2>
        </div>
        <div id="answersList" class="flex-1 overflow-y-auto p-3 space-y-2">
          <!-- Chat messages will be appended here -->
        </div>
        <div class="border-t border-neutral-800 p-3">
          <div class="flex items-end gap-2">
            <textarea id="textArea" placeholder="Start chatting with your AI coach..." autofocus
              class="min-h-24 max-h-32 flex-1 resize-y rounded-2xl border border-neutral-800 bg-neutral-800/70 px-3 py-2 text-sm placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40"></textarea>
            <button id="speechButton"
              class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
              title="Speech to Text">
              <span class="material-symbols-outlined text-base">mic</span>
            </button>
            <button id="actionButton"
              class="grid size-12 place-items-center rounded-full bg-sky-600 text-white hover:bg-sky-500"
              title="Send Message">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 26 27" fill="currentColor"
                aria-hidden="true">
                <path
                  d="M10.8753 20.9288L15.8809 18.3172C20.2537 16.0357 22.4402 14.895 22.4402 13.0885C22.4402 11.2821 20.2537 10.1413 15.8809 7.85984L10.8753 5.24821C7.34598 3.40683 5.58133 2.48614 4.5583 2.76876C3.58508 3.03761 2.82497 3.83076 2.56732 4.84629C2.29649 5.91381 3.17881 7.75518 4.94346 11.4379C5.16215 11.8943 5.60928 12.198 6.09829 12.2003L14.0891 12.2391C14.5386 12.2413 14.9014 12.6234 14.8993 13.0925C14.8972 13.5616 14.531 13.9401 14.0815 13.9379L6.21975 13.8997C5.68076 13.8971 5.1845 14.2361 4.94346 14.7391C3.17882 18.4218 2.29648 20.2632 2.56732 21.3307C2.82497 22.3463 3.58507 23.1394 4.5583 23.4083C5.58133 23.6909 7.34599 22.7702 10.8753 20.9288Z" />
              </svg>
            </button>
            <button id="interruptButton"
              class="grid size-12 place-items-center rounded-full border border-neutral-800 bg-black" title="Interrupt"
              hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true">
                <path
                  d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12Z"
                  stroke="currentcolor" stroke-width="1.5" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </aside>
    <div id="hidden" style="display:none;">
      <h2 id="hidden_h2"></h2>
      <br />
      <h3>Want to continue where we left off?</h3>
      <br /><button id="reconnectButton" class="rounded-full bg-neutral-800 px-4 py-2 text-sm"
        title="Reconnects the previous WebRTC session">Let's
        continue</button>
    </div>
  </div>
  <script type="module" src="/main.js"></script>
  <script src="/webSpeechAPI.js"></script>
</body>

</html>